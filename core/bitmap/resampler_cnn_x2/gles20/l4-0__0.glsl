/*
    Beatmup image and signal processing library
    Copyright (C) 2020, lnstadrum

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
STRINGIFY(
    uniform sampler2D images[3];
    varying highp vec2 texCoord;
    uniform highp vec2 d1;

    lowp vec4 fetch(sampler2D image, highp float x, highp float y) {
        return texture2D(image, vec2(x, y));
    }

    void main() {
            
        highp float
            x0 = texCoord.x - d1.x,
            x1 = texCoord.x,
            x2 = texCoord.x + d1.x,

            y0 = texCoord.y - d1.y,
            y1 = texCoord.y,
            y2 = texCoord.y + d1.y;

        mediump vec4 sum = vec4(0.966767, -0.184626, -0.000156, 1.183150);
    
        sum += fetch(images[0], x0, y0) * mat4(-0.094106,0.263400,-0.234537,-0.569669,-0.088565,-0.011156,0.004856,0.107807,-0.049251,-0.174419,-0.230892,-0.245827,0.082392,0.000520,-0.026700,-0.096506);
        sum += fetch(images[0], x1, y0) * mat4(0.038532,-0.450557,0.373591,1.131684,-0.102877,0.051732,0.052514,-0.151881,0.003585,-0.001440,-0.114406,-0.092042,0.051725,-0.272108,0.081684,-0.014345);
        sum += fetch(images[0], x2, y0) * mat4(0.148117,-0.155814,-0.232094,-0.210939,-0.127935,0.014709,-0.046545,0.027483,-0.131582,-0.030435,-0.184111,-0.083534,0.060045,0.115543,-0.081575,0.155400);
        sum += fetch(images[0], x0, y1) * mat4(0.147892,0.075644,-0.297392,-0.085672,0.041591,0.225617,-0.259904,-0.419782,-0.062078,0.191902,-0.139189,-0.097836,0.194480,0.036327,-0.145520,-0.304531);
        sum += fetch(images[0], x1, y1) * mat4(-0.585503,-0.129758,0.323542,-0.596827,0.171032,-0.193938,0.205621,0.282281,-0.162404,0.093560,-0.208680,-0.842557,-0.323902,0.209960,0.248590,0.477106);
        sum += fetch(images[0], x2, y1) * mat4(0.286943,-0.671453,0.152994,0.119026,-0.125056,0.002908,0.117522,-0.002562,-0.099635,-0.096279,-0.166596,0.044680,-0.114075,-0.264847,-0.199782,-0.220839);
        sum += fetch(images[0], x0, y2) * mat4(-0.084246,-0.195283,-0.184857,-0.249262,-0.050461,-0.226234,-0.065964,0.043655,0.136962,-0.080336,-0.240491,-0.185906,0.086201,0.045197,-0.136755,0.116991);
        sum += fetch(images[0], x1, y2) * mat4(-0.046818,0.622729,0.232271,0.708421,0.226756,0.274245,0.212590,0.164997,-0.016934,-0.201037,-0.091283,-0.258539,0.109080,-0.075755,-0.090322,0.014829);
        sum += fetch(images[0], x2, y2) * mat4(0.132299,0.040097,-0.085806,0.308546,-0.148743,-0.009423,-0.041177,-0.228574,0.191122,-0.007064,-0.020897,-0.191805,0.152609,0.038661,-0.019172,-0.011089);
        sum += fetch(images[1], x0, y0) * mat4(-0.372659,0.060935,-0.038669,-0.171621,0.040843,-0.148038,0.120622,0.105591,-0.057250,-0.048952,0.146995,0.088077,-0.195295,0.036419,-0.132160,-0.174692);
        sum += fetch(images[1], x1, y0) * mat4(-0.040810,-0.206925,-0.221130,0.128790,0.097186,-0.205967,0.025576,0.271124,0.089681,0.019952,-0.175131,-0.157916,-0.125495,0.004099,0.362094,0.506508);
        sum += fetch(images[1], x2, y0) * mat4(0.250063,0.088849,0.053054,-0.277801,-0.016894,0.010377,0.103153,0.133939,-0.183786,0.002679,0.178222,0.109599,-0.235950,0.000755,0.136394,-0.002282);
        sum += fetch(images[1], x0, y1) * mat4(-0.610704,0.758942,0.160460,0.866151,0.092779,-0.017017,-0.082695,-0.373006,0.124205,0.001612,-0.127008,-0.133984,-0.119626,0.280619,-0.058391,-0.365521);
        sum += fetch(images[1], x1, y1) * mat4(0.168785,-1.177520,-0.063923,-2.325581,0.441601,0.313931,-0.496419,-2.451339,0.057192,-0.107030,0.257496,3.130628,0.028547,-0.303182,-0.259625,-0.364667);
        sum += fetch(images[1], x2, y1) * mat4(-0.066103,0.320623,-0.007815,-1.394562,0.065516,-0.200996,0.093170,0.208273,0.060236,-0.025613,-0.169379,-0.170386,-0.114175,0.184144,-0.107736,0.359538);
        sum += fetch(images[1], x0, y2) * mat4(-0.247331,0.086870,0.243077,-0.040351,0.234445,-0.096135,0.211721,-0.100047,-0.106270,-0.191004,-0.019036,-0.187341,-0.329919,0.058051,-0.080651,-0.148146);
        sum += fetch(images[1], x1, y2) * mat4(-0.021447,-0.205979,0.152906,0.400169,0.354297,-0.251671,0.200182,-0.477128,0.078509,0.068970,-0.142985,0.152513,-0.284869,0.266244,0.019778,-0.291220);
        sum += fetch(images[1], x2, y2) * mat4(0.119237,0.126469,-0.458710,-0.410322,0.031796,-0.034691,0.055054,0.128044,-0.041015,-0.098157,-0.127495,-0.117634,-0.276315,0.093307,-0.126157,-0.154241);
        sum += fetch(images[2], x0, y0) * mat4(-0.011455,-0.214181,0.399073,-0.278885,-0.091607,-0.006903,0.008174,-0.013069,-0.069215,-0.172848,-0.082418,0.205440,0.075866,-0.045554,-0.152707,-0.027037);
        sum += fetch(images[2], x1, y0) * mat4(-0.299365,0.685365,-1.425167,-0.090378,-0.150823,0.108514,-0.091546,0.080867,0.263081,0.092775,-0.221498,0.029570,-0.390757,0.170664,-0.161009,0.058665);
        sum += fetch(images[2], x2, y0) * mat4(0.241085,-0.200260,0.650578,0.077021,-0.052687,-0.105875,0.098062,0.055373,-0.042719,-0.246552,-0.463221,0.273781,-0.045667,-0.191675,0.269659,0.001158);
        sum += fetch(images[2], x0, y1) * mat4(-0.027663,-0.212087,0.640171,-0.408417,0.283101,-0.151320,0.103183,-0.179048,0.032021,-0.252208,-0.095814,0.071217,0.180548,0.036000,0.167105,-0.019470);
        sum += fetch(images[2], x1, y1) * mat4(-1.920884,0.509409,0.546142,0.099263,0.976721,0.355900,-0.461785,-0.083048,-0.018273,0.080691,-0.693964,-0.146766,-1.202618,-0.083902,-0.334076,-0.144557);
        sum += fetch(images[2], x2, y1) * mat4(1.173915,0.109005,-0.874860,0.314975,-0.051379,-0.057844,0.054961,-0.018428,0.001010,0.280162,-0.206415,0.014968,-0.273130,0.170952,-0.063539,-0.089454);
        sum += fetch(images[2], x0, y2) * mat4(0.061816,0.061474,0.527566,-0.084521,0.104009,0.070136,0.290311,0.090181,0.116010,0.032995,-0.225516,0.162560,0.045356,0.013970,0.129780,0.030563);
        sum += fetch(images[2], x1, y2) * mat4(-0.552706,-0.328226,-0.078637,-0.060386,0.448940,-0.171383,-0.082411,0.083372,-0.262677,-0.231831,-0.385705,0.046290,0.058745,0.023868,-0.022954,0.050320);
        sum += fetch(images[2], x2, y2) * mat4(0.485698,-0.036915,0.341560,0.089794,-0.063470,0.017928,-0.037941,-0.040378,0.083958,-0.115757,-0.239786,0.160573,0.109146,-0.043959,-0.048658,0.034872);
        gl_FragColor = sum;
    
    }
    )