/*
    Beatmup image and signal processing library
    Copyright (C) 2020, lnstadrum

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

STRINGIFY(
        uniform sampler2D images[3];
        varying highp vec2 texCoord;
        uniform highp vec2 d1;

        lowp vec4 fetch(sampler2D image, highp float x, highp float y) {
            return texture2D(image, vec2(x, y));
        }

        void main() {
            
        highp float
            x0 = texCoord.x - d1.x,
            x1 = texCoord.x,
            x2 = texCoord.x + d1.x,

            y0 = texCoord.y - d1.y,
            y1 = texCoord.y,
            y2 = texCoord.y + d1.y;
            
        lowp vec4 i0, i1, i2, i3, i4, i5, i6, i7, i8;
        mediump vec4 sum = vec4(-0.010042, -0.031309, 0.006339, -0.055728);
    
            i0 = fetch(images[0], x0, y0);
            i1 = fetch(images[0], x1, y0);
            i2 = fetch(images[0], x2, y0);
            i3 = fetch(images[0], x0, y1);
            i4 = fetch(images[0], x1, y1);
            i5 = fetch(images[0], x2, y1);
            i6 = fetch(images[0], x0, y2);
            i7 = fetch(images[0], x1, y2);
            i8 = fetch(images[0], x2, y2);
        
            sum += i0 * mat4(-0.114755, 0.018213, 0.032400, 0.055489, 0.198232, -0.001274, 0.143226, 0.109741, -0.095798, 0.154141, 0.078386, -0.112422, -0.072501, -0.006051, -0.061930, 0.101524);
            sum += i1 * mat4(-0.172610, 0.137959, 0.097049, 0.001358, -0.136958, 0.129448, 0.039120, 0.245791, 0.046244, -0.081652, 0.164870, -0.019805, 0.099851, 0.024068, 0.223644, 0.191228);
            sum += i2 * mat4(0.010351, -0.046918, 0.113290, -0.023302, 0.055177, 0.021540, 0.100580, 0.029476, -0.038282, 0.059775, 0.030179, -0.130831, 0.000961, -0.017147, -0.021399, 0.077338);
            sum += i3 * mat4(-0.100162, -0.144535, 0.029053, -0.125330, -0.445278, 0.155465, 0.231207, -0.177926, 0.041411, 0.103413, -0.138409, 0.090992, 0.347834, -0.121873, 0.113574, -0.129865);
            sum += i4 * mat4(-0.066368, 0.083516, -0.068646, -0.258305, 0.090008, -0.201502, 0.050136, 0.187881, -0.065748, -0.113069, 0.164117, -0.007870, -0.113127, -0.198521, 0.034499, -0.042818);
            sum += i5 * mat4(0.096801, 0.039042, -0.015472, -0.275341, 0.020427, -0.083300, -0.051338, -0.097127, 0.040479, -0.135966, -0.103307, -0.113730, -0.224810, 0.284900, 0.104315, -0.004676);
            sum += i6 * mat4(-0.090115, 0.003276, 0.052176, -0.026614, 0.190404, -0.080494, -0.135100, -0.007244, 0.153881, -0.104199, -0.157310, -0.160003, -0.112930, 0.021406, 0.024885, -0.025398);
            sum += i7 * mat4(-0.141885, -0.016586, 0.130245, -0.273581, 0.007773, 0.074362, -0.113677, -0.109721, 0.191542, 0.066840, -0.140500, -0.045629, 0.150778, -0.059986, 0.082350, -0.079949);
            sum += i8 * mat4(-0.122853, 0.127586, -0.033235, -0.129845, 0.034823, -0.049878, 0.030221, -0.038145, -0.165450, 0.078676, -0.061587, -0.175042, 0.022040, 0.036796, -0.074726, -0.043169);
        
            i0 = fetch(images[1], x0, y0);
            i1 = fetch(images[1], x1, y0);
            i2 = fetch(images[1], x2, y0);
            i3 = fetch(images[1], x0, y1);
            i4 = fetch(images[1], x1, y1);
            i5 = fetch(images[1], x2, y1);
            i6 = fetch(images[1], x0, y2);
            i7 = fetch(images[1], x1, y2);
            i8 = fetch(images[1], x2, y2);
        
            sum += i0 * mat4(-0.164678, -0.031240, -0.078092, -0.209764, -0.055377, -0.321171, -0.030843, -0.051234, -0.069087, -0.152943, 0.147482, -0.131996, -0.026984, -0.003368, -0.001217, 0.093021);
            sum += i1 * mat4(-0.197345, -0.019520, -0.193381, -0.116067, -0.161555, -0.094242, 0.129587, -0.334364, -0.017522, -0.047389, -0.108517, -0.123711, -0.144206, 0.013357, 0.146886, 0.027254);
            sum += i2 * mat4(-0.067573, 0.093795, -0.184316, 0.092837, 0.060799, 0.104030, -0.077115, -0.002186, -0.170468, 0.011243, -0.080285, 0.038104, -0.009810, 0.053021, 0.035283, -0.139736);
            sum += i3 * mat4(-0.155419, -0.087521, -0.131585, -0.010670, -0.216155, 0.011083, 0.074334, -0.098444, -0.179020, -0.131692, 0.137678, 0.132521, -0.088918, 0.123873, -0.128811, 0.045062);
            sum += i4 * mat4(-0.217162, -0.129025, 0.098064, -0.063859, 0.099042, 0.211164, 0.116315, -0.158465, -0.028444, 0.131702, -0.008354, -0.038845, -0.140709, 0.087694, 0.011573, -0.017732);
            sum += i5 * mat4(-0.041267, -0.054669, -0.094813, -0.068804, 0.034826, 0.217849, 0.044528, -0.012799, 0.083484, 0.125062, 0.160265, -0.179212, 0.154173, -0.085106, 0.165514, -0.041098);
            sum += i6 * mat4(-0.178064, -0.250169, 0.052267, 0.072408, 0.079762, 0.069614, 0.144790, 0.044576, -0.090893, -0.100443, 0.106191, -0.168398, 0.119347, -0.157346, 0.110314, -0.024274);
            sum += i7 * mat4(0.095424, -0.086737, -0.195283, -0.172336, -0.120383, 0.088956, 0.105553, 0.028425, -0.104096, 0.152742, 0.005097, -0.133395, 0.132295, -0.155858, 0.164816, 0.040721);
            sum += i8 * mat4(0.098485, -0.208230, -0.001726, -0.048254, 0.075490, 0.121771, 0.103030, 0.017916, -0.202322, 0.062168, 0.059392, 0.102526, -0.012750, 0.117196, 0.153084, -0.017035);
        
            i0 = fetch(images[2], x0, y0);
            i1 = fetch(images[2], x1, y0);
            i2 = fetch(images[2], x2, y0);
            i3 = fetch(images[2], x0, y1);
            i4 = fetch(images[2], x1, y1);
            i5 = fetch(images[2], x2, y1);
            i6 = fetch(images[2], x0, y2);
            i7 = fetch(images[2], x1, y2);
            i8 = fetch(images[2], x2, y2);
        
            sum += i0 * mat4(-0.140291, 0.044029, -0.257355, 0.074152, -0.180302, 0.209884, -0.045362, 0.113197, 0.144943, -0.224181, -0.025934, 0.137312, 0.027733, -0.070165, -0.047697, -0.082445);
            sum += i1 * mat4(0.053924, -0.087992, 0.011592, -0.023195, 0.017644, -0.079619, 0.066691, -0.061334, -0.019199, 0.092316, -0.225049, -0.183048, 0.007574, 0.243689, 0.162874, 0.121041);
            sum += i2 * mat4(0.210281, 0.035245, -0.089309, 0.068581, 0.030862, 0.032172, -0.107794, -0.065522, -0.012656, 0.008159, -0.351277, 0.053516, -0.050918, -0.007802, -0.059300, -0.138217);
            sum += i3 * mat4(0.121337, 0.104725, -0.208902, -0.056526, 0.023861, 0.137075, -0.241724, 0.141315, -0.049435, -0.137964, -0.171695, 0.043651, 0.110344, -0.038624, -0.284602, -0.281077);
            sum += i4 * mat4(0.092360, -0.017339, 0.026812, -0.084576, 0.321834, -0.016977, 0.108750, -0.370012, -0.000053, 0.036982, -0.186334, 0.004011, -0.345144, 0.125199, 0.160275, 0.581492);
            sum += i5 * mat4(0.225806, 0.110868, -0.304630, 0.030830, -0.144471, 0.037187, 0.047859, 0.238274, -0.182611, 0.121561, -0.042324, -0.050124, 0.078504, -0.075617, 0.011459, -0.219729);
            sum += i6 * mat4(-0.023108, -0.027268, -0.130278, 0.001801, -0.087617, -0.034679, 0.124424, 0.031443, -0.161893, -0.118370, -0.291996, 0.005157, 0.114378, 0.075921, -0.002173, -0.013744);
            sum += i7 * mat4(0.132873, -0.040404, -0.007436, -0.127144, -0.058826, 0.071208, 0.079733, 0.069256, -0.018221, -0.178671, -0.263542, -0.078510, -0.105585, -0.013863, -0.132010, -0.127198);
            sum += i8 * mat4(-0.048990, 0.151990, -0.075380, -0.063945, 0.164826, -0.016628, 0.052514, -0.064663, 0.066473, -0.133251, -0.088821, 0.110031, -0.052688, 0.086880, 0.083399, 0.025215);
        
        gl_FragColor = sum;
    
        }
    )
