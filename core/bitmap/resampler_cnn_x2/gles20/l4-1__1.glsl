/*
    Beatmup image and signal processing library
    Copyright (C) 2020, lnstadrum

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
STRINGIFY(
    uniform sampler2D images[3];
    varying highp vec2 texCoord;
    uniform highp vec2 d1;

    lowp vec4 fetch(sampler2D image, highp float x, highp float y) {
        return texture2D(image, vec2(x, y));
    }

    void main() {
            
        highp float
            x0 = texCoord.x - d1.x,
            x1 = texCoord.x,
            x2 = texCoord.x + d1.x,

            y0 = texCoord.y - d1.y,
            y1 = texCoord.y,
            y2 = texCoord.y + d1.y;

        mediump vec4 sum = vec4(-0.031441, -0.010613, -0.012751, -0.051503);
    
        sum += fetch(images[0], x0, y0) * mat4(-0.160608,-0.099572,0.177323,-0.005505,-0.015994,-0.019998,0.032436,-0.005495,0.208567,0.186288,-0.075618,0.164693,0.248607,-0.130713,0.091201,0.238700);
        sum += fetch(images[0], x1, y0) * mat4(-0.654068,-0.807715,0.419663,0.227368,0.085241,-0.003818,-0.030183,0.063206,0.579518,0.368072,-0.412402,-0.294923,0.086025,0.147656,-0.032053,0.132987);
        sum += fetch(images[0], x2, y0) * mat4(-0.141288,-0.027294,-0.223389,-0.013889,0.035366,0.003488,-0.001219,0.041728,0.226543,0.033076,-0.112068,0.165451,-0.266840,-0.205063,0.131053,-0.062626);
        sum += fetch(images[0], x0, y1) * mat4(0.196747,0.104342,0.215669,0.201286,-0.136378,0.071389,-0.064887,0.047669,0.125433,0.112546,0.173818,0.122688,0.479584,-0.505831,0.143145,-0.247322);
        sum += fetch(images[0], x1, y1) * mat4(-2.210140,0.832064,-0.080324,-0.019415,0.105519,-0.234579,0.174820,-0.081376,-2.508358,0.263553,0.590829,-0.201919,-2.688199,0.626725,0.053312,-0.130296);
        sum += fetch(images[0], x2, y1) * mat4(-0.035441,0.083986,0.282131,0.165500,0.330247,0.198087,-0.069487,-0.019126,0.145822,0.118065,0.219200,0.168951,-0.303579,-0.738099,0.024538,0.418419);
        sum += fetch(images[0], x0, y2) * mat4(0.211399,0.035517,-0.053672,0.116474,-0.023892,-0.006434,0.008754,-0.032132,-0.184893,-0.030457,0.029267,0.096395,0.225346,-0.149914,0.186787,0.191579);
        sum += fetch(images[0], x1, y2) * mat4(0.921547,-0.121638,0.294507,-0.348647,0.115289,0.000985,-0.013587,0.020941,-0.325563,0.029510,-0.398100,0.288854,0.061816,0.048925,-0.045264,0.006985);
        sum += fetch(images[0], x2, y2) * mat4(0.062654,0.038827,0.245832,0.121237,0.049172,-0.012440,0.025896,0.034928,-0.189239,0.217706,-0.014461,0.048788,-0.247745,-0.059293,-0.222308,-0.003553);
        sum += fetch(images[1], x0, y0) * mat4(0.066499,0.115361,-0.010719,-0.126971,0.005102,0.011498,0.002263,-0.039607,-0.141880,-0.078614,0.094886,-0.061619,-0.186259,-0.027988,0.038202,0.282182);
        sum += fetch(images[1], x1, y0) * mat4(0.115707,0.240576,-0.119460,-0.291740,0.002890,0.009270,0.005231,0.046727,-0.324075,-0.168078,0.196653,0.142681,-0.092373,-0.108980,0.009295,0.014956);
        sum += fetch(images[1], x2, y0) * mat4(-0.030565,0.014136,0.026416,-0.162595,-0.012254,0.013497,-0.006492,0.025820,-0.092813,-0.014697,0.046959,-0.035877,0.101740,-0.045095,-0.043834,0.238909);
        sum += fetch(images[1], x0, y1) * mat4(-0.107499,-0.100821,0.056119,-0.002806,0.045238,0.050869,-0.031763,-0.020434,-0.042550,0.051857,0.064961,0.002156,-0.335789,-0.479282,0.215746,0.232664);
        sum += fetch(images[1], x1, y1) * mat4(-0.078865,-0.461638,-0.167304,-0.072744,0.032343,0.017518,-0.022964,0.106702,-0.353553,0.359897,-0.279174,-0.105352,-0.639166,-0.371603,-0.415886,-0.453145);
        sum += fetch(images[1], x2, y1) * mat4(0.019714,0.006327,-0.047019,-0.062801,-0.071816,-0.053353,0.042543,-0.126030,0.054526,0.010832,-0.010919,0.029518,0.229374,0.249512,-0.195635,0.530278);
        sum += fetch(images[1], x0, y2) * mat4(-0.151947,-0.071713,0.015743,-0.190134,0.003037,0.019625,0.002576,-0.034908,0.091297,-0.019406,0.007911,0.003111,-0.141060,-0.321790,0.080186,0.328682);
        sum += fetch(images[1], x1, y2) * mat4(-0.370042,0.218496,0.162820,-0.095259,-0.017337,0.005131,0.011239,0.089209,0.230756,-0.399303,-0.171432,-0.080968,-0.080076,-0.413437,-0.038481,-0.390486);
        sum += fetch(images[1], x2, y2) * mat4(-0.051201,-0.116232,0.034829,-0.130034,-0.014815,-0.032132,-0.001426,-0.045966,0.117005,-0.066419,0.031915,-0.148782,0.122457,0.178909,-0.057564,0.275499);
        sum += fetch(images[2], x0, y0) * mat4(-0.085694,-0.243475,0.054398,0.113842,-0.015701,0.007561,0.012882,-0.002954,-0.060709,-0.396906,-0.033476,-0.073137,0.063893,-0.158933,-0.096935,0.072241);
        sum += fetch(images[2], x1, y0) * mat4(-0.205530,0.005176,0.147164,-0.147187,0.049117,-0.008079,0.033607,0.028374,-0.021227,-0.223636,-0.399007,0.201499,0.043702,0.187811,0.160621,0.009254);
        sum += fetch(images[2], x2, y0) * mat4(0.014937,-0.111621,0.152334,-0.052157,0.005408,-0.013796,-0.052202,0.024533,0.068176,0.010762,-0.288498,0.065484,0.020751,-0.122231,-0.002512,-0.123270);
        sum += fetch(images[2], x0, y1) * mat4(0.072457,-0.211894,-0.028410,0.035829,-0.093419,0.022601,0.034615,0.025986,0.196243,0.379121,0.016230,-0.069788,0.341241,0.025569,-0.180052,0.011504);
        sum += fetch(images[2], x1, y1) * mat4(0.196217,0.172450,0.180646,0.193471,0.411245,0.006052,-0.063782,0.697410,0.251429,0.443924,-0.236015,-0.090836,0.588776,0.034560,0.671239,0.031074);
        sum += fetch(images[2], x2, y1) * mat4(0.074440,0.060847,0.053794,0.036744,-0.164393,-0.031326,0.056777,0.057577,-0.081085,-0.078481,-0.166011,0.028406,0.157746,-0.214200,-0.695935,0.013593);
        sum += fetch(images[2], x0, y2) * mat4(0.024339,0.132090,0.077492,-0.035798,-0.004197,-0.025864,0.013492,-0.021227,-0.089434,-0.114011,0.001814,0.007507,0.048599,0.411535,-0.034425,0.115794);
        sum += fetch(images[2], x1, y2) * mat4(0.041168,-0.028175,-0.338109,-0.115401,0.079133,0.054451,0.013281,0.075409,-0.244926,-0.334446,0.226499,-0.122978,0.143592,-0.336636,0.196010,-0.105503);
        sum += fetch(images[2], x2, y2) * mat4(-0.134714,-0.203708,-0.145832,-0.054891,-0.036981,-0.021661,-0.035964,0.020017,-0.038885,0.052254,0.219713,-0.005983,0.156282,-0.147494,-0.133407,-0.039087);
        gl_FragColor = sum;
    
    }
    )