/*
    Beatmup image and signal processing library
    Copyright (C) 2020, lnstadrum

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
STRINGIFY(
    uniform sampler2D images[3];
    varying highp vec2 texCoord;
    uniform highp vec2 d1;

    lowp vec4 fetch(sampler2D image, highp float x, highp float y) {
        return texture2D(image, vec2(x, y));
    }

    void main() {
            
        highp float
            x0 = texCoord.x - d1.x,
            x1 = texCoord.x,
            x2 = texCoord.x + d1.x,

            y0 = texCoord.y - d1.y,
            y1 = texCoord.y,
            y2 = texCoord.y + d1.y;

        mediump vec4 sum = vec4(0.400508, -0.023574, -0.754653, -0.112271);
    
        sum += fetch(images[0], x0, y0) * mat4(-0.953884,-0.007651,-0.343214,-0.065068,0.431431,-0.018850,-0.129220,-3.575548,-0.729442,0.327596,-0.263534,-0.180258,0.511394,-0.163091,0.024412,0.025506);
        sum += fetch(images[0], x1, y0) * mat4(0.365774,-0.852430,-0.445131,-0.063919,-0.187048,0.100917,0.323003,-0.463504,-1.914080,1.048768,-0.392766,0.277225,0.062713,0.440830,-0.072748,0.054938);
        sum += fetch(images[0], x2, y0) * mat4(0.001377,0.251500,0.095403,0.583735,-0.084301,-0.165861,-0.212189,-1.202044,2.452495,-3.014219,1.015246,1.243305,-0.034389,0.123053,0.060656,0.013350);
        sum += fetch(images[0], x0, y1) * mat4(0.112125,0.333996,0.158970,-0.573873,-0.112964,-0.186870,0.256616,-1.770144,-0.035176,0.814528,0.221598,-1.182346,-0.113767,-0.044554,0.023150,0.078831);
        sum += fetch(images[0], x1, y1) * mat4(0.187150,-0.215632,-0.245080,-0.528767,0.152004,-0.325462,-0.563911,-0.181681,0.941956,0.440930,-1.273886,-0.038418,-0.066425,0.052528,0.043415,-0.031335);
        sum += fetch(images[0], x2, y1) * mat4(-0.067422,-0.072709,0.407427,-0.163209,0.016601,-0.098049,0.279376,-1.313284,-0.471825,-1.443641,-1.381740,-0.534312,-0.003519,0.051814,0.063132,0.037376);
        sum += fetch(images[0], x0, y2) * mat4(-0.130768,0.041198,-0.030463,-0.267940,-0.329189,0.138732,-0.063198,0.123052,-0.010789,0.117375,-0.562092,0.287111,0.089724,0.025575,0.027640,0.032941);
        sum += fetch(images[0], x1, y2) * mat4(-0.042561,0.286882,0.539004,-0.200920,0.175118,0.349372,0.111346,-0.035207,-0.059050,-0.232452,-0.625488,0.172913,0.048541,-0.049443,-0.034479,0.064546);
        sum += fetch(images[0], x2, y2) * mat4(-0.005869,0.137359,0.058153,0.179375,0.011630,0.056058,0.388145,-1.378997,-0.178213,0.812181,0.863435,-1.424623,-0.025696,-0.050277,-0.010149,0.054978);
        sum += fetch(images[1], x0, y0) * mat4(0.151283,0.146577,0.074648,-0.018113,-0.346820,0.037120,0.068915,-0.424820,-0.108551,0.412678,0.286960,0.371630,-0.077981,0.002278,-0.031409,-0.004814);
        sum += fetch(images[1], x1, y0) * mat4(0.255464,0.113460,-0.033143,-0.003696,0.143233,0.065329,0.578487,-0.252805,-1.001587,0.094141,0.284998,0.280495,-0.063751,0.206704,-0.001947,0.004887);
        sum += fetch(images[1], x2, y0) * mat4(0.260925,0.299679,0.076142,-0.027995,-0.145894,-0.090245,0.087146,-0.131694,0.030444,-0.981211,0.787072,0.042808,-0.022289,0.311567,0.006620,-0.012956);
        sum += fetch(images[1], x0, y1) * mat4(0.528825,0.004334,0.330012,-0.234902,-0.111209,-0.023013,0.024248,0.233054,1.502122,-0.010575,0.109967,0.560095,0.069542,-0.032724,-0.047388,-0.010260);
        sum += fetch(images[1], x1, y1) * mat4(-0.403947,-0.336631,-0.167359,-0.043222,-0.040678,0.064036,-2.784345,0.042848,-0.019161,-0.300078,0.330577,0.445006,-0.149396,0.152856,-0.082395,-0.012161);
        sum += fetch(images[1], x2, y1) * mat4(-0.303069,-0.049157,0.168019,0.007944,0.025392,-0.165385,0.170638,-0.632056,-4.785531,-0.939636,0.449713,1.200859,0.030548,0.292944,0.060106,-0.035980);
        sum += fetch(images[1], x0, y2) * mat4(-0.031281,-0.007467,0.101705,0.140250,0.281087,-0.137133,0.086928,-0.493827,0.142346,-0.370113,0.451938,0.747596,-0.043917,-0.019131,-0.006693,-0.002497);
        sum += fetch(images[1], x1, y2) * mat4(0.129385,0.173606,0.124099,0.445908,0.120128,0.059987,0.258528,-0.163474,-0.367653,-0.275204,0.380803,-0.018374,-0.011403,-0.008733,0.000878,0.013033);
        sum += fetch(images[1], x2, y2) * mat4(0.065091,0.123081,-0.061669,0.078985,0.153092,0.051309,0.212676,0.226914,-0.152757,0.063811,-0.044339,0.940831,0.016949,-0.135259,-0.016111,-0.246937);
        sum += fetch(images[2], x0, y0) * mat4(-0.095228,0.189700,-0.200356,0.046157,-0.384825,0.081879,-0.004333,0.341922,-4.015074,1.324409,-0.581346,-0.505059,-0.009278,-0.016029,0.007388,0.007642);
        sum += fetch(images[2], x1, y0) * mat4(0.141255,0.189079,-0.058081,0.171611,-1.064699,0.193254,0.077660,0.160328,-2.219945,1.009465,-0.318419,-0.653107,-0.022403,-0.021735,0.005830,0.026214);
        sum += fetch(images[2], x2, y0) * mat4(0.054946,0.425526,-0.016556,0.218245,0.029720,-0.019191,-0.088481,0.399514,-3.191976,0.713585,0.588899,-0.090875,-0.056287,-0.033920,0.002896,0.050782);
        sum += fetch(images[2], x0, y1) * mat4(0.062951,-0.013698,-0.084388,0.126675,-1.556149,0.259392,-0.059830,0.198220,-3.309488,0.673847,0.107516,-0.590321,0.027994,-0.005858,0.025784,0.002026);
        sum += fetch(images[2], x1, y1) * mat4(-0.396473,0.048404,-0.050868,0.003475,-2.613727,-0.080712,-0.201843,0.279463,0.870967,0.011989,0.146759,-0.438217,-0.055457,0.001605,0.012545,-0.039245);
        sum += fetch(images[2], x2, y1) * mat4(0.261207,0.473401,0.108665,0.087093,-0.978731,-0.085350,-0.211773,0.249009,-1.595922,-0.205353,-0.784813,-0.399039,0.031692,0.061205,0.032675,-0.019690);
        sum += fetch(images[2], x0, y2) * mat4(0.029700,0.241107,-0.206756,0.008980,-1.739890,0.122661,0.175794,0.498936,-1.307255,0.299888,0.078366,-0.073441,0.067070,-0.016442,0.041628,-0.030202);
        sum += fetch(images[2], x1, y2) * mat4(0.130964,0.289278,-0.513693,0.105074,-1.735401,0.520110,-1.292803,0.044976,-1.027414,0.363226,-1.174270,0.543370,0.005813,0.002032,-0.229933,-0.020308);
        sum += fetch(images[2], x2, y2) * mat4(-0.224090,0.429244,0.303681,0.181771,-1.930220,2.092917,-0.151479,-0.140610,-2.079044,-0.089900,0.444689,-0.457736,-0.028226,0.039200,-0.021159,0.005346);
        gl_FragColor = sum;
    
    }
    )