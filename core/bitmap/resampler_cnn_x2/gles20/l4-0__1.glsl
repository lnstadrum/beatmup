/*
    Beatmup image and signal processing library
    Copyright (C) 2020, lnstadrum

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
STRINGIFY(
    uniform sampler2D images[3];
    varying highp vec2 texCoord;
    uniform highp vec2 d1;

    lowp vec4 fetch(sampler2D image, highp float x, highp float y) {
        return texture2D(image, vec2(x, y));
    }

    void main() {
            
        highp float
            x0 = texCoord.x - d1.x,
            x1 = texCoord.x,
            x2 = texCoord.x + d1.x,

            y0 = texCoord.y - d1.y,
            y1 = texCoord.y,
            y2 = texCoord.y + d1.y;

        mediump vec4 sum = vec4(0.050992, -0.098173, -0.189357, -0.181490);
    
        sum += fetch(images[0], x0, y0) * mat4(0.003571,0.021319,0.006621,-0.008918,-0.022004,-0.107210,-0.096004,-0.427823,-0.055104,0.217673,-0.107572,-0.223639,-0.123095,-0.080033,0.043446,0.073911);
        sum += fetch(images[0], x1, y0) * mat4(0.028376,-0.000609,0.011655,0.012720,-0.007024,0.011489,0.040373,-0.407383,-0.008050,-0.172566,0.162567,0.051308,-0.096239,0.068568,0.024848,-0.001337);
        sum += fetch(images[0], x2, y0) * mat4(0.005435,-0.006431,0.011073,-0.015259,-0.153709,0.056732,0.061797,-0.224087,-0.114514,0.041683,-0.066551,0.015296,-0.120605,0.102747,0.022027,-0.066238);
        sum += fetch(images[0], x0, y1) * mat4(0.015617,-0.000220,-0.052605,-0.035172,0.030183,0.208655,0.306612,-0.145090,0.051327,-0.126483,-0.279167,-0.099265,-0.105198,-0.071506,0.063189,0.266724);
        sum += fetch(images[0], x1, y1) * mat4(0.239669,0.015896,-0.014178,-0.009279,-0.836012,-0.232837,0.007916,-0.068462,0.391108,0.198739,0.179473,0.241891,0.155606,0.330248,-0.175353,-0.222438);
        sum += fetch(images[0], x2, y1) * mat4(0.035994,-0.021156,0.031475,0.020828,-0.059061,-0.323246,-0.114695,-0.293737,-0.200202,-0.012257,0.098989,-0.061582,0.053341,-0.142736,0.206062,-0.052434);
        sum += fetch(images[0], x0, y2) * mat4(-0.001908,-0.004665,0.010989,0.004075,0.162955,-0.248283,-0.301660,-0.203675,-0.088077,-0.072900,0.055812,0.012231,-0.134025,-0.018259,0.186127,-0.038368);
        sum += fetch(images[0], x1, y2) * mat4(0.044461,-0.014544,-0.004199,0.009043,0.461278,-0.229933,-0.125989,-0.131500,-0.132100,0.083700,0.111318,0.050192,0.147578,-0.175282,-0.069054,-0.218641);
        sum += fetch(images[0], x2, y2) * mat4(-0.008019,0.011240,0.016420,0.014532,0.156002,0.448721,0.104686,-0.297050,-0.083757,-0.026232,-0.033591,-0.171637,-0.017835,0.153285,0.108194,0.146094);
        sum += fetch(images[1], x0, y0) * mat4(0.005191,-0.051638,0.002485,-0.016497,0.228275,0.160874,0.325278,0.083021,0.076079,-0.071733,-0.015490,-0.060975,0.138893,-0.007883,0.057817,0.157212);
        sum += fetch(images[1], x1, y0) * mat4(0.012718,-0.029211,-0.085319,-0.172451,0.163487,-0.220154,0.540710,0.040557,0.360275,0.011663,-0.508982,-0.451392,0.047015,-0.230963,0.098595,0.217113);
        sum += fetch(images[1], x2, y0) * mat4(0.021673,-0.030575,-0.008085,-0.025286,0.435631,-0.069655,0.466625,0.176690,0.025105,-0.010061,0.168021,0.166185,0.018894,-0.123855,0.077757,0.145437);
        sum += fetch(images[1], x0, y1) * mat4(-0.014826,-0.013527,0.017392,-0.144188,-0.335979,-0.190309,-0.001769,0.148398,-0.010660,-0.027587,0.176505,-0.353902,0.135091,-0.298963,0.185399,0.324105);
        sum += fetch(images[1], x1, y1) * mat4(-0.027910,0.200052,0.015553,-0.354616,-0.923987,-0.004112,-0.208590,-4.863925,0.123370,0.106371,0.234465,0.481532,0.247666,0.492948,-0.536962,-2.716118);
        sum += fetch(images[1], x2, y1) * mat4(-0.012039,-0.037253,-0.003649,-0.155655,-0.486442,0.095362,-0.111554,-0.093569,-0.054709,-0.214700,0.035288,0.216030,0.313923,-0.090120,-0.136755,-0.345739);
        sum += fetch(images[1], x0, y2) * mat4(0.002599,-0.032010,0.000319,-0.016717,-0.251542,0.095105,0.141665,-0.108886,0.298758,-0.126448,0.093787,0.110087,0.351355,-0.107173,0.038012,0.157573);
        sum += fetch(images[1], x1, y2) * mat4(-0.012929,-0.031483,0.038434,-0.154862,0.021590,0.003586,0.211129,-0.552737,0.396778,-0.320324,0.049777,0.266781,0.094160,-0.180518,0.270427,-0.485223);
        sum += fetch(images[1], x2, y2) * mat4(0.020498,-0.031942,-0.000678,-0.024139,0.174151,-0.058289,0.103286,0.001786,0.114276,0.042151,0.059398,0.113767,0.295287,-0.106429,0.128602,-0.044864);
        sum += fetch(images[2], x0, y0) * mat4(-0.006987,-0.013892,-0.013010,-0.008627,-0.070797,0.063560,0.299000,0.061349,0.048678,-0.150137,-0.079683,-0.045234,-0.070884,0.020053,0.174984,-0.030366);
        sum += fetch(images[2], x1, y0) * mat4(0.101900,0.002285,-0.019075,-0.027732,-0.042951,-0.074859,-0.420824,0.267735,0.340765,0.305584,-0.176223,-0.141997,-0.095998,-0.057412,-0.108960,0.091024);
        sum += fetch(images[2], x2, y0) * mat4(0.011069,0.022061,-0.005836,-0.004366,-0.096027,-0.076590,0.392814,0.194342,-0.041287,-0.031567,0.181521,0.153179,-0.124220,-0.026396,0.062372,0.069813);
        sum += fetch(images[2], x0, y1) * mat4(0.037119,-0.018350,0.022238,0.012607,0.065267,0.028406,-0.427999,-0.218703,0.290269,0.168385,0.448220,0.133160,-0.167479,0.052806,-0.057232,-0.023353);
        sum += fetch(images[2], x1, y1) * mat4(0.466599,0.038754,-0.007486,0.007431,-0.050404,-0.335782,0.554411,-0.064533,1.081160,-0.187851,-0.526586,0.144421,1.081703,-0.274123,0.429952,-0.154475);
        sum += fetch(images[2], x2, y1) * mat4(0.076876,-0.002035,-0.015261,0.007486,0.119963,0.483623,-0.736616,-0.274030,-0.078242,-0.022678,-0.038231,-0.033281,0.289259,0.228114,-0.390740,-0.099839);
        sum += fetch(images[2], x0, y2) * mat4(0.000273,0.007620,0.008438,-0.000584,-0.008540,0.587401,0.168594,0.179724,-0.034701,-0.076817,0.081091,-0.069341,-0.080066,-0.047563,-0.270140,-0.022038);
        sum += fetch(images[2], x1, y2) * mat4(0.043077,-0.029496,0.002425,0.016833,0.239316,-0.136788,-0.377174,0.187205,-0.147837,0.067577,0.139120,-0.011718,0.525068,0.210691,0.101176,0.125176);
        sum += fetch(images[2], x2, y2) * mat4(-0.013792,-0.010700,0.020480,-0.003726,-0.075011,-0.142015,0.327058,0.066449,-0.035496,-0.020078,-0.058563,-0.006606,0.053600,-0.167675,0.196104,0.006291);
        gl_FragColor = sum;
    
    }
    )