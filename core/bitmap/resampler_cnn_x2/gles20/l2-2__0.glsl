/*
    Beatmup image and signal processing library
    Copyright (C) 2020, lnstadrum

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
STRINGIFY(
    uniform sampler2D images[3];
    varying highp vec2 texCoord;
    uniform highp vec2 d1;

    lowp vec4 fetch(sampler2D image, highp float x, highp float y) {
        return texture2D(image, vec2(x, y));
    }

    void main() {
            
        highp float
            x0 = texCoord.x - d1.x,
            x1 = texCoord.x,
            x2 = texCoord.x + d1.x,

            y0 = texCoord.y - d1.y,
            y1 = texCoord.y,
            y2 = texCoord.y + d1.y;

        mediump vec4 sum = vec4(-0.771607, 0.024048, 0.015689, -0.587401);
    
        sum += fetch(images[0], x0, y0) * mat4(0.579588,0.372588,-0.706110,0.695823,0.135461,0.016531,-0.025625,0.753206,-1.389178,-0.168663,0.364421,0.717104,-0.665869,0.080417,0.789274,1.204229);
        sum += fetch(images[0], x1, y0) * mat4(0.947549,-2.859058,0.035478,2.937527,0.418285,-0.048989,0.108977,-1.684644,0.124318,0.094613,0.142296,-1.189758,1.026467,-0.042039,0.396806,-0.536407);
        sum += fetch(images[0], x2, y0) * mat4(0.334109,-1.546571,-0.745573,-0.920159,-0.171006,0.232758,0.039330,-0.435330,-1.487501,0.249936,-0.093080,1.506834,1.172267,0.343856,0.452062,0.940546);
        sum += fetch(images[0], x0, y1) * mat4(-1.240773,0.678431,-0.101235,-0.061241,-0.065056,-0.096069,-0.111671,-0.133162,0.326821,-0.237475,-0.360190,1.951876,0.349161,0.168569,-0.676558,0.998075);
        sum += fetch(images[0], x1, y1) * mat4(-0.093676,-0.142510,1.197643,-2.593762,-0.304033,-0.253093,-0.111212,-0.389254,-0.146902,0.127532,-0.650746,1.223638,-1.580946,0.541351,-0.326560,0.870565);
        sum += fetch(images[0], x2, y1) * mat4(0.431920,0.273713,-0.692725,-0.981026,0.126800,0.230150,0.026611,-0.688974,0.252308,0.085378,0.245755,2.163740,0.794485,0.148584,-0.164557,0.518035);
        sum += fetch(images[0], x0, y2) * mat4(0.014211,-0.048998,0.325616,-0.506733,0.319000,0.291634,-0.125890,-0.127955,-0.483672,-0.020899,-0.158056,0.794007,-0.978201,0.190146,0.069212,1.342467);
        sum += fetch(images[0], x1, y2) * mat4(-0.538072,0.170949,-1.552136,-0.369055,-0.757710,-0.827679,0.160546,0.024493,0.090030,0.138917,-0.278248,1.243908,-1.430849,0.042139,-0.435705,0.828231);
        sum += fetch(images[0], x2, y2) * mat4(0.326588,0.104446,0.389035,-0.017258,0.047187,0.010239,0.050380,0.141288,-0.776078,0.052468,-0.145628,0.184275,0.038480,0.497802,-0.346534,1.764521);
        sum += fetch(images[1], x0, y0) * mat4(-0.016622,-0.124329,0.951122,0.255017,0.008366,0.102168,0.118387,0.163014,-0.020491,-0.268702,0.279321,-0.017280,-0.479156,-0.071781,2.125622,-0.047216);
        sum += fetch(images[1], x1, y0) * mat4(-0.289007,-0.706189,-1.241990,-0.105582,-0.019527,-0.141451,-0.514100,-0.122602,-0.052375,0.086252,2.626304,0.491900,-0.652337,-0.877278,1.220634,0.002288);
        sum += fetch(images[1], x2, y0) * mat4(-0.270886,-0.119622,0.084786,0.238761,0.021442,-0.014745,-0.973411,-0.430562,-0.283271,0.050750,2.068123,-0.873715,0.235620,-0.016599,1.717195,0.278790);
        sum += fetch(images[1], x0, y1) * mat4(0.430599,-0.270442,-1.530176,0.260345,0.089072,0.043215,-0.002663,0.905600,-0.350390,0.083823,1.420292,-0.291769,1.190091,-0.279942,0.154405,-0.108965);
        sum += fetch(images[1], x1, y1) * mat4(-0.398354,-0.178394,-0.843756,0.259042,0.100769,-0.085147,1.341888,-0.145827,-0.299380,0.607847,-0.131255,-0.294111,0.956713,-0.156831,0.744523,0.605145);
        sum += fetch(images[1], x2, y1) * mat4(-0.172203,0.266221,3.859740,-0.232144,0.008793,0.001044,-0.202228,-0.836829,0.213655,-0.098060,-1.701448,0.650132,0.274291,0.684395,0.412316,-0.305205);
        sum += fetch(images[1], x0, y2) * mat4(-1.182766,0.404278,0.166622,-0.183401,0.209526,0.065230,0.276529,0.453768,0.556314,-0.396518,0.613176,0.028897,-0.319668,-0.155626,0.981244,-0.515260);
        sum += fetch(images[1], x1, y2) * mat4(-2.491424,-0.201002,-0.282871,-0.351465,0.111859,0.136292,-0.420706,0.286601,0.721114,-0.045065,-0.794815,0.762471,-0.675822,-0.234464,-0.005468,-0.417660);
        sum += fetch(images[1], x2, y2) * mat4(0.185688,0.526589,1.305071,0.022872,0.010464,0.173454,1.174759,-0.419266,-0.836958,-0.390333,-0.643963,-0.548157,-0.473705,0.211952,1.153639,-0.249667);
        sum += fetch(images[2], x0, y0) * mat4(-0.163214,-0.182927,0.263731,0.612764,-0.050826,0.073326,-0.061709,0.460603,0.265043,0.186447,-0.105360,0.109241,-1.483502,0.403235,-0.185508,0.618627);
        sum += fetch(images[2], x1, y0) * mat4(0.464158,-0.458196,-0.087655,0.261427,-0.105961,0.082762,0.080994,0.078538,-0.149014,-0.090035,0.325735,-0.471766,0.085650,0.220818,-0.116694,-0.156378);
        sum += fetch(images[2], x2, y0) * mat4(-0.604999,-0.469764,0.295797,0.374949,-0.456616,0.035687,-0.034262,-0.020482,-0.321282,0.074659,-0.100532,0.338679,0.497035,-0.374294,0.182427,-0.430601);
        sum += fetch(images[2], x0, y1) * mat4(1.206075,-1.330051,0.948374,0.292929,-0.084793,0.016911,0.071907,-2.126406,-0.383621,0.148097,-0.492441,1.119089,0.119675,-1.208276,0.088091,0.067649);
        sum += fetch(images[2], x1, y1) * mat4(-0.031728,-0.179383,-0.882243,0.321814,0.370678,0.152308,-0.079566,0.170582,0.103152,0.219995,0.395472,0.624804,0.478907,-0.616944,-0.371050,-0.140479);
        sum += fetch(images[2], x2, y1) * mat4(0.056183,-0.433396,0.604471,0.749184,0.262505,0.037632,-0.072423,0.059014,0.140638,-0.104293,-0.171516,-1.109769,-0.416793,0.671435,0.781190,-0.057597);
        sum += fetch(images[2], x0, y2) * mat4(0.033960,1.462344,0.175155,0.470529,-0.091115,-0.129305,-0.292353,-0.330444,0.179172,-0.313095,0.075942,0.070839,0.209109,0.241034,-0.074777,-0.084283);
        sum += fetch(images[2], x1, y2) * mat4(-0.256919,1.089843,0.472038,0.145060,-0.239481,-0.193307,-0.116693,0.211716,0.068914,-0.296322,0.300183,-0.332776,-0.413368,0.092833,0.273235,-0.886564);
        sum += fetch(images[2], x2, y2) * mat4(-0.706433,0.122400,-0.095946,0.200112,0.536961,0.058746,-0.205012,-0.051760,0.071523,0.327425,0.253134,0.147992,-0.498374,0.773661,0.643460,-0.630860);
        gl_FragColor = sum;
    
    }
    )