/*
    Beatmup image and signal processing library
    Copyright (C) 2020, lnstadrum

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

STRINGIFY(
        uniform highp uint inputStride;
        layout(binding = 0, std430) readonly buffer inFeatures_ { highp uint data[][8]; } inFeatures;
        layout(binding = 0, rgba8) uniform writeonly lowp image2D[6] outFeatures;
        void main() {
            lowp vec4 f[8];
            for (int i = 0; i < 8; ++i)
                f[i] = unpackUnorm4x8(inFeatures.data[ gl_GlobalInvocationID.y * inputStride + gl_GlobalInvocationID.x ][i]);
            mediump vec4 sum;
            sum = vec4(0.017410, 0.022572, 0.054556, -0.031126) + vec4(
                dot(vec4(-0.252126,-0.242144,0.117084,-0.132702), f[0]) + dot(vec4(0.127865,-0.252344,0.322198,-0.155683), f[1]) + dot(vec4(0.547305,0.020524,-0.045916,-0.134462), f[2]) + dot(vec4(0.345354,0.372740,0.123347,-0.403906), f[3]) + dot(vec4(-0.300054,-0.023707,0.572507,0.263337), f[4]) + dot(vec4(0.042556,0.077427,0.108896,-0.435867), f[5]) + dot(vec4(0.406181,0.061378,-0.400790,-0.030865), f[6]) + dot(vec4(-0.274727,-0.217618,0.194801,-0.543920), f[7]),
                dot(vec4(-0.017875,-0.355846,-0.046530,-0.396200), f[0]) + dot(vec4(0.176187,-0.099441,-0.161924,0.223951), f[1]) + dot(vec4(0.010400,-0.050064,0.420149,0.173052), f[2]) + dot(vec4(0.168248,-0.131145,0.032333,-0.015751), f[3]) + dot(vec4(-0.065950,-0.154427,0.258832,0.385409), f[4]) + dot(vec4(0.225860,-0.343601,-0.062952,0.027433), f[5]) + dot(vec4(-0.176993,-0.117001,0.540424,-0.022135), f[6]) + dot(vec4(-0.312847,0.215080,-0.159207,0.102902), f[7]),
                dot(vec4(-0.052403,-0.306354,-0.267390,-0.040456), f[0]) + dot(vec4(0.062542,0.154981,-0.252139,0.189715), f[1]) + dot(vec4(0.072998,0.218112,0.404643,0.240041), f[2]) + dot(vec4(-0.042164,-0.169113,0.070921,-0.101108), f[3]) + dot(vec4(-0.006682,0.373462,0.020076,0.109603), f[4]) + dot(vec4(0.232229,-0.338240,-0.049583,0.189561), f[5]) + dot(vec4(0.046800,0.010614,0.480897,-0.314840), f[6]) + dot(vec4(-0.256822,0.272001,0.083232,0.236393), f[7]),
                dot(vec4(0.117436,-0.431948,0.310359,0.002164), f[0]) + dot(vec4(-0.553898,-0.233355,-0.048573,-0.273020), f[1]) + dot(vec4(-0.573837,-0.423906,0.021357,-0.077188), f[2]) + dot(vec4(-0.527228,0.330722,0.509363,-0.071118), f[3]) + dot(vec4(-0.254311,0.321716,0.123364,-0.309190), f[4]) + dot(vec4(0.234208,0.033504,-0.139172,-0.006956), f[5]) + dot(vec4(0.213465,-0.103781,-0.053797,-0.339927), f[6]) + dot(vec4(0.074393,0.725498,0.013804,0.020300), f[7])
            );
            imageStore(outFeatures[0], ivec2(gl_GlobalInvocationID.xy), sum);
            sum = vec4(-0.107753, 0.068446, 0.025846, -0.032269) + vec4(
                dot(vec4(0.055876,0.177210,-0.051522,0.283873), f[0]) + dot(vec4(-0.116973,0.281799,0.055905,-0.128258), f[1]) + dot(vec4(0.009184,0.125242,0.015966,-0.010202), f[2]) + dot(vec4(-0.070879,-0.156507,0.115037,-0.097470), f[3]) + dot(vec4(0.245747,-0.135955,-0.049770,0.188307), f[4]) + dot(vec4(-0.391254,0.039058,0.102572,-0.034395), f[5]) + dot(vec4(0.083545,0.161361,-0.028600,-0.000068), f[6]) + dot(vec4(0.231604,0.175694,0.178903,-0.082046), f[7]),
                dot(vec4(0.515885,0.190248,-0.097944,-0.067832), f[0]) + dot(vec4(-0.224788,0.266262,0.016807,-0.162557), f[1]) + dot(vec4(-0.246043,-0.148687,0.201186,-0.045879), f[2]) + dot(vec4(0.490289,0.074054,-0.361585,-0.183870), f[3]) + dot(vec4(0.272062,0.002080,-0.028351,-0.287422), f[4]) + dot(vec4(-0.187889,-0.130660,-0.181960,0.086034), f[5]) + dot(vec4(0.201469,-0.270017,0.245712,-0.097141), f[6]) + dot(vec4(-0.003175,0.039137,0.005032,0.139614), f[7]),
                dot(vec4(-0.165958,-0.130224,0.011347,0.050711), f[0]) + dot(vec4(0.059367,-0.222354,-0.116148,0.206650), f[1]) + dot(vec4(0.168267,0.473339,-0.200884,0.001075), f[2]) + dot(vec4(-0.260489,0.099904,0.178306,0.123270), f[3]) + dot(vec4(0.219992,0.041969,0.075181,0.231194), f[4]) + dot(vec4(0.130405,0.159468,0.476651,-0.237148), f[5]) + dot(vec4(-0.221953,-0.108773,-0.150325,0.070254), f[6]) + dot(vec4(-0.149652,0.216296,-0.125102,-0.142614), f[7]),
                dot(vec4(-0.132434,-0.318489,0.172630,-0.258627), f[0]) + dot(vec4(0.030739,0.147420,-0.227831,0.160869), f[1]) + dot(vec4(-0.149877,0.292166,-0.252180,-0.242255), f[2]) + dot(vec4(0.051046,0.237812,-0.133260,-0.254408), f[3]) + dot(vec4(-0.134048,-0.214093,0.052929,0.028543), f[4]) + dot(vec4(0.016680,0.211384,-0.050921,-0.103808), f[5]) + dot(vec4(-0.132501,-0.258967,0.151876,-0.246464), f[6]) + dot(vec4(0.069683,0.135605,0.187209,-0.294939), f[7])
            );
            imageStore(outFeatures[1], ivec2(gl_GlobalInvocationID.xy), sum);
            sum = vec4(0.024834, 0.055467, 0.165176, -0.016339) + vec4(
                dot(vec4(-0.142662,0.029175,0.292268,-0.210924), f[0]) + dot(vec4(0.225712,0.273442,0.165847,-0.049175), f[1]) + dot(vec4(0.243792,0.188194,-0.044814,-0.121869), f[2]) + dot(vec4(-0.031255,-0.109573,0.112486,0.016066), f[3]) + dot(vec4(0.033843,0.336996,0.018682,-0.160641), f[4]) + dot(vec4(-0.036933,-0.073204,-0.119812,0.070284), f[5]) + dot(vec4(0.178934,0.186611,-0.142801,0.125743), f[6]) + dot(vec4(0.125269,-0.096885,0.031887,-0.021972), f[7]),
                dot(vec4(0.003226,0.131354,-0.181189,0.242710), f[0]) + dot(vec4(0.132400,-0.228519,-0.286046,-0.132875), f[1]) + dot(vec4(0.066407,-0.191003,0.345487,0.268070), f[2]) + dot(vec4(0.016501,0.098930,-0.157445,-0.082926), f[3]) + dot(vec4(-0.090302,-0.005998,0.075565,0.132387), f[4]) + dot(vec4(-0.125473,-0.264530,0.264183,0.035046), f[5]) + dot(vec4(-0.148875,-0.356086,-0.110931,0.456497), f[6]) + dot(vec4(-0.211740,0.278611,-0.286625,-0.087502), f[7]),
                dot(vec4(-0.130920,-0.067394,0.043304,0.139261), f[0]) + dot(vec4(-0.087821,0.278087,0.138187,0.013557), f[1]) + dot(vec4(-0.277861,0.111572,0.171196,0.304873), f[2]) + dot(vec4(0.066508,-0.220565,0.187344,-0.180929), f[3]) + dot(vec4(0.195435,0.281249,0.008815,-0.031908), f[4]) + dot(vec4(-0.098254,-0.057548,-0.212316,0.181428), f[5]) + dot(vec4(0.056573,-0.015729,0.113484,0.333081), f[6]) + dot(vec4(-0.309695,-0.213251,0.262508,0.190758), f[7]),
                dot(vec4(-0.148442,-0.310235,0.164248,0.263715), f[0]) + dot(vec4(0.029710,0.105435,0.605753,-0.074656), f[1]) + dot(vec4(-0.253049,-0.137701,-0.081494,-0.182242), f[2]) + dot(vec4(-0.011536,-0.248495,0.417547,-0.361306), f[3]) + dot(vec4(-0.125664,-0.207380,-0.042862,-0.677891), f[4]) + dot(vec4(0.103101,0.512081,-0.106052,0.248160), f[5]) + dot(vec4(0.128735,0.277099,-0.032930,-0.616054), f[6]) + dot(vec4(0.507746,-0.315417,-0.078738,0.006112), f[7])
            );
            imageStore(outFeatures[2], ivec2(gl_GlobalInvocationID.xy), sum);
            sum = vec4(-0.104560, -0.065912, -0.023047, 0.047032) + vec4(
                dot(vec4(-0.375087,-0.472107,-0.028681,-0.037674), f[0]) + dot(vec4(0.180004,-0.018353,-0.300071,0.541296), f[1]) + dot(vec4(0.345114,0.602660,0.087529,-0.458162), f[2]) + dot(vec4(-0.425916,-0.627896,0.480727,0.724968), f[3]) + dot(vec4(-0.133688,-0.037489,0.174703,0.392320), f[4]) + dot(vec4(-0.156841,0.296058,-0.055750,-0.717911), f[5]) + dot(vec4(-0.189740,0.416395,-0.121797,0.459862), f[6]) + dot(vec4(-0.124395,-0.247039,0.090555,-0.195341), f[7]),
                dot(vec4(-0.665019,-0.210356,-0.082411,-0.006756), f[0]) + dot(vec4(0.425116,0.304922,-0.159783,0.105716), f[1]) + dot(vec4(0.514571,-0.496269,-0.069306,-0.917412), f[2]) + dot(vec4(-0.580240,0.455972,0.006455,0.510781), f[3]) + dot(vec4(0.248665,0.100267,0.078514,-0.168260), f[4]) + dot(vec4(0.059096,-0.207698,0.136463,-0.465461), f[5]) + dot(vec4(-0.121690,0.403541,-0.391473,0.304237), f[6]) + dot(vec4(0.127155,0.361669,-0.093915,-0.106284), f[7]),
                dot(vec4(0.209985,0.131095,0.254755,-0.154817), f[0]) + dot(vec4(0.253843,-0.229747,0.064304,-0.131631), f[1]) + dot(vec4(0.042842,0.148966,-0.136679,-0.141938), f[2]) + dot(vec4(0.218100,-0.041761,0.197892,-0.128468), f[3]) + dot(vec4(0.219608,0.249513,0.083193,0.143936), f[4]) + dot(vec4(0.152235,0.297899,-0.177414,0.069118), f[5]) + dot(vec4(-0.216363,0.256450,-0.247842,0.066319), f[6]) + dot(vec4(-0.185392,-0.108431,-0.181804,0.207740), f[7]),
                dot(vec4(0.089607,0.013432,0.115306,0.382707), f[0]) + dot(vec4(0.160799,0.262646,-0.159878,-0.043106), f[1]) + dot(vec4(-0.047748,-0.088558,-0.052828,0.193872), f[2]) + dot(vec4(0.002276,0.162943,-0.262136,-0.124907), f[3]) + dot(vec4(-0.083558,0.116752,-0.032571,0.023170), f[4]) + dot(vec4(0.273172,0.124839,0.016067,0.207543), f[5]) + dot(vec4(-0.125803,-0.101115,-0.155801,0.158421), f[6]) + dot(vec4(-0.264103,0.255994,-0.052291,0.121493), f[7])
            );
            imageStore(outFeatures[3], ivec2(gl_GlobalInvocationID.xy), sum);
            sum = vec4(0.115109, 0.044356, 0.004719, 0.034634) + vec4(
                dot(vec4(-0.010094,0.138123,-0.019232,0.128520), f[0]) + dot(vec4(0.003854,-0.018847,0.109888,-0.137384), f[1]) + dot(vec4(0.031048,0.079735,-0.030004,-0.027498), f[2]) + dot(vec4(0.231529,0.095551,-0.166393,-0.097703), f[3]) + dot(vec4(0.012682,-0.163489,0.041044,-0.069166), f[4]) + dot(vec4(0.097232,0.069606,-0.027458,0.171633), f[5]) + dot(vec4(0.210206,-0.003477,0.274198,-0.207563), f[6]) + dot(vec4(-0.025100,0.038482,0.046304,0.172634), f[7]),
                dot(vec4(-0.093765,0.045710,-0.083093,0.305241), f[0]) + dot(vec4(-0.152851,-0.255047,-0.055496,-0.016859), f[1]) + dot(vec4(-0.156729,-0.047002,0.020086,-0.081720), f[2]) + dot(vec4(0.122338,0.154403,-0.044341,0.170198), f[3]) + dot(vec4(0.006779,0.027161,0.060211,0.042242), f[4]) + dot(vec4(0.155586,0.108510,0.006348,0.019823), f[5]) + dot(vec4(-0.167904,0.019202,0.002058,0.114100), f[6]) + dot(vec4(-0.026571,0.005746,0.081878,-0.012995), f[7]),
                dot(vec4(0.000790,0.000049,0.193043,0.223069), f[0]) + dot(vec4(0.178134,0.198169,-0.161874,0.026543), f[1]) + dot(vec4(-0.169991,-0.196638,-0.120109,0.139372), f[2]) + dot(vec4(-0.061052,0.200921,-0.093028,0.021757), f[3]) + dot(vec4(0.269542,0.289838,-0.068420,0.056229), f[4]) + dot(vec4(0.216501,-0.215403,0.132606,-0.064272), f[5]) + dot(vec4(0.002029,-0.276611,0.249666,-0.196687), f[6]) + dot(vec4(0.067495,0.157648,-0.124504,-0.067595), f[7]),
                dot(vec4(0.512666,0.263772,0.221709,-0.188780), f[0]) + dot(vec4(-0.459129,-0.077893,0.589545,-0.254947), f[1]) + dot(vec4(-0.297823,-0.347858,-0.172339,-0.549811), f[2]) + dot(vec4(0.505569,-0.029217,-0.162404,-0.052892), f[3]) + dot(vec4(0.348001,-0.199247,-0.265576,-0.394747), f[4]) + dot(vec4(-0.028247,0.200294,-0.463218,0.084735), f[5]) + dot(vec4(0.214350,0.304840,-0.014270,-0.381873), f[6]) + dot(vec4(0.117540,-0.124940,0.157854,0.271116), f[7])
            );
            imageStore(outFeatures[4], ivec2(gl_GlobalInvocationID.xy), sum);
            sum = vec4(-0.020420, 0.033188, 0.064994, -0.19245) + vec4(
                dot(vec4(0.053259,-0.112037,-0.084111,-0.149046), f[0]) + dot(vec4(-0.172362,0.293199,-0.040350,0.153782), f[1]) + dot(vec4(0.355087,0.007064,0.362957,-0.691431), f[2]) + dot(vec4(-0.125504,-0.339471,-0.125976,0.000840), f[3]) + dot(vec4(0.352941,0.017458,0.067334,-0.103171), f[4]) + dot(vec4(-0.230846,-0.346597,-0.014139,-0.080798), f[5]) + dot(vec4(-0.038493,0.217314,-0.041173,0.432711), f[6]) + dot(vec4(0.262872,0.247423,-0.176407,-0.073326), f[7]),
                dot(vec4(0.031750,-0.213146,-0.021746,0.110896), f[0]) + dot(vec4(-0.112883,0.198841,-0.001079,0.172485), f[1]) + dot(vec4(0.489706,0.308194,0.038799,0.186685), f[2]) + dot(vec4(-0.545181,-0.249594,0.148477,-0.086228), f[3]) + dot(vec4(0.290387,0.161785,-0.015383,-0.049266), f[4]) + dot(vec4(0.005402,0.102561,0.209584,0.008983), f[5]) + dot(vec4(-0.110551,0.454321,-0.323038,0.244951), f[6]) + dot(vec4(-0.104136,0.308779,0.251464,0.057520), f[7]),
                dot(vec4(0.258932,0.079620,0.031104,0.226165), f[0]) + dot(vec4(0.192799,-0.035544,-0.190123,-0.104465), f[1]) + dot(vec4(0.230408,-0.162102,-0.180104,-0.030632), f[2]) + dot(vec4(-0.090977,-0.166879,0.164576,-0.251363), f[3]) + dot(vec4(0.018125,-0.072575,0.049107,0.054167), f[4]) + dot(vec4(0.283078,0.168029,-0.078216,-0.067408), f[5]) + dot(vec4(0.012882,0.100934,-0.040421,-0.004997), f[6]) + dot(vec4(0.062229,0.069396,-0.017565,0.042032), f[7]),
                dot(vec4(-0.116323,-0.785883,0.205909,0.073174), f[0]) + dot(vec4(-0.212455,-0.154290,-0.390948,1.042846), f[1]) + dot(vec4(0.492488,-0.200328,0.543313,0.860420), f[2]) + dot(vec4(-0.154311,-0.166430,0.018086,0.182116), f[3]) + dot(vec4(-0.343958,0.271096,-0.217405,0.187951), f[4]) + dot(vec4(0.297018,0.024377,-0.208669,-0.219234), f[5]) + dot(vec4(-0.793007,-0.030600,-0.071312,-0.259475), f[6]) + dot(vec4(0.303709,0.005426,-0.245330,-0.024524), f[7])
            );
            imageStore(outFeatures[5], ivec2(gl_GlobalInvocationID.xy), sum);
        }
    )
